{"ast":null,"code":"import _objectSpread from\"/Users/eveyhuang/Documents/novohaven-app/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import api from'../../services/api';import{Button,Input,TextArea,Select,Card,CardBody,CardHeader,Modal,DynamicInput,TranslatedText}from'../common';import{useLanguage}from'../../context/LanguageContext';import{useNotifications}from'../../context/NotificationContext';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const DEFAULT_STEP={step_order:1,step_name:'New Step',ai_model:'mock',prompt_template:'',output_format:'text',model_config:JSON.stringify({temperature:0.7,maxTokens:2000})};export function RecipeRunner(){const{id}=useParams();const navigate=useNavigate();const{t}=useLanguage();const{trackExecution,addNotification}=useNotifications();const[recipe,setRecipe]=useState(null);const[localSteps,setLocalSteps]=useState([]);const[inputValues,setInputValues]=useState({});const[inputConfigs,setInputConfigs]=useState({});const[models,setModels]=useState([]);const[isLoading,setIsLoading]=useState(true);const[isStarting,setIsStarting]=useState(false);const[error,setError]=useState(null);const[expandedSteps,setExpandedSteps]=useState(new Set([0]));const[showVariableHelp,setShowVariableHelp]=useState(false);const[showRunOptions,setShowRunOptions]=useState(false);useEffect(()=>{loadModels();if(id){loadRecipe(parseInt(id));}},[id]);const loadModels=async()=>{try{const{all}=await api.getAIModels();setModels(all);}catch(err){console.error('Failed to load models:',err);}};const loadRecipe=async recipeId=>{setIsLoading(true);try{const data=await api.getRecipe(recipeId);setRecipe(data);setLocalSteps(data.steps||[]);// Initialize input values and configs from step input_config\nconst initialValues={};const configs={};// Collect input configs and default values from all steps\n(data.steps||[]).forEach(step=>{if(step.input_config){try{const config=JSON.parse(step.input_config);// Collect variable configurations\nif(config.variables){Object.entries(config.variables).forEach(_ref=>{let[key,varConfig]=_ref;configs[key]=varConfig;});}// Collect default values (if any)\nif(config.defaultValues){Object.entries(config.defaultValues).forEach(_ref2=>{let[key,value]=_ref2;if(value){initialValues[key]=value;}});}}catch(_unused){// Ignore parse errors\n}}});// Then ensure all required inputs have appropriate default values\n(data.required_inputs||[]).forEach(input=>{if(!(input in initialValues)){const inputConfig=configs[input];// Set appropriate default based on type\nif((inputConfig===null||inputConfig===void 0?void 0:inputConfig.type)==='url_list'){initialValues[input]=[''];}else if((inputConfig===null||inputConfig===void 0?void 0:inputConfig.type)==='image'||(inputConfig===null||inputConfig===void 0?void 0:inputConfig.type)==='file'){initialValues[input]=null;}else{initialValues[input]='';}}});setInputValues(initialValues);setInputConfigs(configs);}catch(err){setError(err.message);}finally{setIsLoading(false);}};// Extract required inputs from current step prompts and input configs\nconst extractRequiredInputs=()=>{const inputs=new Set();const variableRegex=/\\{\\{([^}]+)\\}\\}/g;const standardNames=['brand_voice','amazon_requirements','social_media_guidelines','image_style_guidelines','platform_requirements','tone_guidelines'];for(const step of localSteps){// For scraping steps, get inputs from input_config\nif(step.step_type==='scraping'&&step.input_config){try{const config=JSON.parse(step.input_config);if(config.variables){// Handle both array format and object format\nif(Array.isArray(config.variables)){// Array format: [{ name: 'product_urls', source: 'user_input', ... }]\nfor(const variable of config.variables){if(variable.source==='user_input'&&variable.required!==false){inputs.add(variable.name);}}}else{// Object format: { product_urls: { type: 'url_list', ... } }\nfor(const[varName,varConfig]of Object.entries(config.variables)){const cfg=varConfig;// Skip optional variables\nif(cfg.optional!==true){inputs.add(varName);}}}}}catch(_unused2){// Ignore parse errors\n}continue;}// For AI steps, get inputs from prompt_template\nlet match;const template=step.prompt_template||'';while((match=variableRegex.exec(template))!==null){const varName=match[1].trim();// Skip step outputs and company standards\nif(!varName.match(/^step_\\d+_output$/)&&!standardNames.some(s=>varName.toLowerCase().includes(s.replace(/_/g,'')))){inputs.add(varName);}}}return Array.from(inputs);};const requiredInputs=extractRequiredInputs();const updateStep=(index,updates)=>{const newSteps=[...localSteps];newSteps[index]=_objectSpread(_objectSpread({},newSteps[index]),updates);setLocalSteps(newSteps);};const addStep=()=>{const newStep=_objectSpread(_objectSpread({},DEFAULT_STEP),{},{step_order:localSteps.length+1,step_name:\"Step \".concat(localSteps.length+1)});setLocalSteps([...localSteps,newStep]);setExpandedSteps(new Set([...expandedSteps,localSteps.length]));};const removeStep=index=>{if(localSteps.length<=1){setError('Recipe must have at least one step');return;}const newSteps=localSteps.filter((_,i)=>i!==index);// Renumber steps\nnewSteps.forEach((step,i)=>{step.step_order=i+1;});setLocalSteps(newSteps);};const moveStep=(index,direction)=>{const newIndex=direction==='up'?index-1:index+1;if(newIndex<0||newIndex>=localSteps.length)return;const newSteps=[...localSteps];[newSteps[index],newSteps[newIndex]]=[newSteps[newIndex],newSteps[index]];// Renumber steps\nnewSteps.forEach((step,i)=>{step.step_order=i+1;});setLocalSteps(newSteps);};const toggleStepExpanded=index=>{const newExpanded=new Set(expandedSteps);if(newExpanded.has(index)){newExpanded.delete(index);}else{newExpanded.add(index);}setExpandedSteps(newExpanded);};const validateAndPrepareInputs=()=>{// Check for missing required inputs based on their type\nconst missingInputs=requiredInputs.filter(input=>{const value=inputValues[input];const config=inputConfigs[input];if(!config||config.type==='text'||config.type==='textarea'){return!value||typeof value==='string'&&!value.trim();}else if(config.type==='image'||config.type==='file'){return!value;}else if(config.type==='url_list'){return!Array.isArray(value)||value.filter(u=>u.trim()).length===0;}return!value;});if(missingInputs.length>0){setError(\"\".concat(t('fillRequiredFields'),\": \").concat(missingInputs.map(i=>{var _inputConfigs$i;return((_inputConfigs$i=inputConfigs[i])===null||_inputConfigs$i===void 0?void 0:_inputConfigs$i.label)||formatLabel(i);}).join(', ')));return null;}// Prepare input data - convert complex types to strings for prompt injection\nconst processedInputs={};for(const[key,value]of Object.entries(inputValues)){const config=inputConfigs[key];if((config===null||config===void 0?void 0:config.type)==='image'&&value!==null&&value!==void 0&&value.base64){// For images, include the base64 data (will be used by vision models)\nprocessedInputs[key]=value.base64;processedInputs[\"\".concat(key,\"_description\")]=\"[Image: \".concat(value.name,\"]\");}else if((config===null||config===void 0?void 0:config.type)==='file'&&value!==null&&value!==void 0&&value.content){// For files, include the content\nprocessedInputs[key]=value.content;}else if((config===null||config===void 0?void 0:config.type)==='url_list'&&Array.isArray(value)){// For URL lists, join them\nprocessedInputs[key]=value.filter(u=>u.trim()).join('\\n');}else if(typeof value==='string'){processedInputs[key]=value;}else{processedInputs[key]=String(value||'');}}// Check that all AI steps have prompts (scraping steps don't need prompts)\nconst emptyPromptSteps=localSteps.filter(s=>s.step_type!=='scraping'&&(!s.prompt_template||!s.prompt_template.trim()));if(emptyPromptSteps.length>0){setError('All AI steps must have a prompt template');return null;}return processedInputs;};const handleStartExecution=async function(){let runInBackground=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!recipe)return;const processedInputs=validateAndPrepareInputs();if(!processedInputs)return;setIsStarting(true);setError(null);setShowRunOptions(false);try{// Pass modified steps to the execution with processed inputs\nconst result=await api.startExecution(recipe.id,processedInputs,localSteps);if(runInBackground){// Track the execution in background and navigate to dashboard\ntrackExecution(result.executionId,recipe.name);addNotification({type:'info',title:'Workflow Started',message:\"\\\"\".concat(recipe.name,\"\\\" is now running in the background.\"),autoClose:true,duration:3000});navigate('/');}else{// Navigate directly to the execution view\nnavigate(\"/executions/\".concat(result.executionId));}}catch(err){setError(err.message);setIsStarting(false);}};const handleShowRunOptions=()=>{const processedInputs=validateAndPrepareInputs();if(processedInputs){setShowRunOptions(true);}};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"})});}if(!recipe){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary-600\",children:t('recipeNotFound')}),/*#__PURE__*/_jsx(Button,{onClick:()=>navigate('/'),className:\"mt-4\",children:t('goToDashboard')})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-secondary-900\",children:/*#__PURE__*/_jsx(TranslatedText,{text:recipe.name})}),recipe.is_template&&/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-0.5 text-xs font-medium bg-primary-100 text-primary-700 rounded\",children:t('template')})]}),recipe.description&&/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary-600 mt-1\",children:/*#__PURE__*/_jsx(TranslatedText,{text:recipe.description})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Button,{variant:\"ghost\",onClick:()=>navigate('/'),children:t('cancel')}),/*#__PURE__*/_jsx(Button,{onClick:handleShowRunOptions,isLoading:isStarting,children:t('startWorkflow')})]})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 text-red-700 px-4 py-3 rounded-lg\",children:error}),requiredInputs.length>0&&/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(CardHeader,{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"font-semibold text-secondary-900\",children:t('inputValues')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-500 mt-1\",children:t('provideInputs')})]}),/*#__PURE__*/_jsx(CardBody,{className:\"space-y-4\",children:requiredInputs.map(input=>{const config=inputConfigs[input]||{type:'text',label:formatLabel(input),placeholder:\"Enter \".concat(formatLabel(input).toLowerCase(),\"...\")};// Ensure label defaults to formatted input name\nif(!config.label){config.label=formatLabel(input);}return/*#__PURE__*/_jsx(DynamicInput,{name:input,config:config,value:inputValues[input],onChange:value=>setInputValues(_objectSpread(_objectSpread({},inputValues),{},{[input]:value})),t:t},input);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-semibold text-secondary-900\",children:t('workflowSteps')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-500\",children:t('customizePrompts')})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowVariableHelp(true),className:\"text-sm text-primary-600 hover:text-primary-700\",children:t('variableHelp')}),/*#__PURE__*/_jsx(Button,{size:\"sm\",onClick:addStep,children:t('addStep')})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:localSteps.map((step,index)=>{var _models$find;return/*#__PURE__*/_jsxs(Card,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"px-6 py-4 flex items-center justify-between cursor-pointer hover:bg-secondary-50\",onClick:()=>toggleStepExpanded(index),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-semibold \".concat(step.step_type==='scraping'?'bg-blue-100 text-blue-700':'bg-primary-100 text-primary-700'),children:step.step_type==='scraping'?'üîç':index+1}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-secondary-900\",children:/*#__PURE__*/_jsx(TranslatedText,{text:step.step_name})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-500\",children:step.step_type==='scraping'?'BrightData Scraping':((_models$find=models.find(m=>m.id===step.ai_model))===null||_models$find===void 0?void 0:_models$find.name)||step.ai_model})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();moveStep(index,'up');},disabled:index===0,className:\"p-1 text-secondary-400 hover:text-secondary-600 disabled:opacity-30\",children:/*#__PURE__*/_jsx(ChevronUpIcon,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();moveStep(index,'down');},disabled:index===localSteps.length-1,className:\"p-1 text-secondary-400 hover:text-secondary-600 disabled:opacity-30\",children:/*#__PURE__*/_jsx(ChevronDownIcon,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();removeStep(index);},className:\"p-1 text-red-400 hover:text-red-600\",children:/*#__PURE__*/_jsx(TrashIcon,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(ChevronIcon,{className:\"w-5 h-5 text-secondary-400 transition-transform \".concat(expandedSteps.has(index)?'transform rotate-180':'')})]})]}),expandedSteps.has(index)&&/*#__PURE__*/_jsxs(CardBody,{className:\"border-t border-secondary-100 space-y-4\",children:[/*#__PURE__*/_jsx(Input,{label:t('stepName'),value:step.step_name,onChange:e=>updateStep(index,{step_name:e.target.value}),placeholder:t('stepNamePlaceholder')}),step.step_type==='scraping'?/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 border border-blue-200 rounded-lg p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-2xl\",children:\"\\uD83D\\uDD0D\"}),/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-blue-800\",children:\"Scraping Step\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-blue-700\",children:\"This step extracts product reviews from e-commerce URLs using the BrightData API. You can also upload CSV files with review data.\"}),step.api_config&&(()=>{try{const apiConfig=JSON.parse(step.api_config);return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-blue-600 font-medium\",children:\"Service:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-blue-800\",children:apiConfig.service}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-4 text-blue-600 font-medium\",children:\"Endpoint:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-blue-800\",children:apiConfig.endpoint})]});}catch(_unused3){return null;}})()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-secondary-50 rounded-lg p-4\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-sm font-medium text-secondary-700 mb-2\",children:\"Supported Platforms\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded border border-orange-200\",children:\"\\uD83D\\uDCE6 Amazon\"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded border border-blue-200\",children:\"\\uD83D\\uDED2 Walmart\"}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded border border-purple-200\",children:\"\\uD83C\\uDFE0 Wayfair\"})]})]})]}):/*#__PURE__*//* AI Step UI */_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Select,{label:t('aiModel'),value:step.ai_model,onChange:e=>updateStep(index,{ai_model:e.target.value}),options:models.map(m=>({value:m.id,label:\"\".concat(m.name).concat(m.available?'':\" (\".concat(t('notConfigured'),\")\"))}))}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-secondary-700 mb-1\",children:t('promptTemplate')}),/*#__PURE__*/_jsx(TextArea,{value:step.prompt_template,onChange:e=>updateStep(index,{prompt_template:e.target.value}),placeholder:t('promptTemplatePlaceholder'),rows:8,className:\"font-mono text-sm\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-1 text-sm text-secondary-500\",children:t('promptTemplateHelp')})]}),/*#__PURE__*/_jsx(Select,{label:t('outputFormat'),value:step.output_format,onChange:e=>updateStep(index,{output_format:e.target.value}),options:[{value:'text',label:t('plainText')},{value:'markdown',label:t('markdown')},{value:'json',label:t('json')}]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-secondary-200 pt-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-secondary-700 mb-3\",children:t('modelSettings')}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsx(Input,{label:t('temperature'),type:\"number\",min:\"0\",max:\"2\",step:\"0.1\",value:JSON.parse(step.model_config||'{}').temperature||0.7,onChange:e=>{const config=JSON.parse(step.model_config||'{}');config.temperature=parseFloat(e.target.value);updateStep(index,{model_config:JSON.stringify(config)});}}),/*#__PURE__*/_jsx(Input,{label:t('maxTokens'),type:\"number\",min:\"100\",max:\"100000\",step:\"100\",value:JSON.parse(step.model_config||'{}').maxTokens||2000,onChange:e=>{const config=JSON.parse(step.model_config||'{}');config.maxTokens=parseInt(e.target.value);updateStep(index,{model_config:JSON.stringify(config)});}})]})]})]})]})]},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between pt-4 border-t border-secondary-200\",children:[/*#__PURE__*/_jsx(Button,{variant:\"ghost\",onClick:()=>navigate('/'),children:t('cancel')}),/*#__PURE__*/_jsx(Button,{onClick:handleShowRunOptions,isLoading:isStarting,size:\"lg\",children:t('startWorkflow')})]}),/*#__PURE__*/_jsx(Modal,{isOpen:showVariableHelp,onClose:()=>setShowVariableHelp(false),title:t('variableReference'),size:\"lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary-900\",children:t('userInputVariables')}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-secondary-600 mt-1\",children:[/*#__PURE__*/_jsx(\"code\",{className:\"bg-secondary-100 px-1 rounded\",children:'{{variable_name}}'}),\" \",t('userInputVariablesDesc')]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\",children:['{{product_name}}',/*#__PURE__*/_jsx(\"br\",{}),'{{target_audience}}',/*#__PURE__*/_jsx(\"br\",{}),'{{additional_context}}']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary-900\",children:t('previousStepOutputs')}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-secondary-600 mt-1\",children:[t('previousStepOutputsDesc'),\" \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-secondary-100 px-1 rounded\",children:'{{step_N_output}}'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\",children:['{{step_1_output}}',/*#__PURE__*/_jsx(\"br\",{}),'{{step_2_output}}']})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-secondary-900\",children:t('companyStandards')}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-600 mt-1\",children:t('companyStandardsDesc')}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\",children:['{{brand_voice}}',/*#__PURE__*/_jsx(\"br\",{}),'{{amazon_requirements}}',/*#__PURE__*/_jsx(\"br\",{}),'{{image_style_guidelines}}']})]})]})}),/*#__PURE__*/_jsx(Modal,{isOpen:showRunOptions,onClose:()=>setShowRunOptions(false),title:\"Start Workflow\",size:\"md\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-secondary-600\",children:\"Choose how you want to run this workflow:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleStartExecution(false),disabled:isStarting,className:\"w-full p-4 border-2 border-secondary-200 rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-left group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-200\",children:/*#__PURE__*/_jsxs(\"svg\",{className:\"w-5 h-5 text-primary-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"}),/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-secondary-900\",children:\"Run and Watch\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-500 mt-1\",children:\"Stay on the execution page to monitor progress and approve steps in real-time.\"})]})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleStartExecution(true),disabled:isStarting,className:\"w-full p-4 border-2 border-secondary-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left group\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 group-hover:bg-blue-200\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-5 h-5 text-blue-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-secondary-900\",children:\"Run in Background\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-secondary-500 mt-1\",children:\"Start the workflow and continue working. You'll be notified when it needs attention or completes.\"})]})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pt-3 border-t border-secondary-200\",children:/*#__PURE__*/_jsx(Button,{variant:\"ghost\",onClick:()=>setShowRunOptions(false),className:\"w-full\",children:\"Cancel\"})})]})})]});}function formatLabel(varName){return varName.replace(/_/g,' ').replace(/\\b\\w/g,c=>c.toUpperCase());}// Icons\nfunction ChevronUpIcon(_ref3){let{className}=_ref3;return/*#__PURE__*/_jsx(\"svg\",{className:className,fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M5 15l7-7 7 7\"})});}function ChevronDownIcon(_ref4){let{className}=_ref4;return/*#__PURE__*/_jsx(\"svg\",{className:className,fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})});}function ChevronIcon(_ref5){let{className}=_ref5;return/*#__PURE__*/_jsx(\"svg\",{className:className,fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 9l-7 7-7-7\"})});}function TrashIcon(_ref6){let{className}=_ref6;return/*#__PURE__*/_jsx(\"svg\",{className:className,fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"})});}","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","api","Button","Input","TextArea","Select","Card","CardBody","CardHeader","Modal","DynamicInput","TranslatedText","useLanguage","useNotifications","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","DEFAULT_STEP","step_order","step_name","ai_model","prompt_template","output_format","model_config","JSON","stringify","temperature","maxTokens","RecipeRunner","id","navigate","t","trackExecution","addNotification","recipe","setRecipe","localSteps","setLocalSteps","inputValues","setInputValues","inputConfigs","setInputConfigs","models","setModels","isLoading","setIsLoading","isStarting","setIsStarting","error","setError","expandedSteps","setExpandedSteps","Set","showVariableHelp","setShowVariableHelp","showRunOptions","setShowRunOptions","loadModels","loadRecipe","parseInt","all","getAIModels","err","console","recipeId","data","getRecipe","steps","initialValues","configs","forEach","step","input_config","config","parse","variables","Object","entries","_ref","key","varConfig","defaultValues","_ref2","value","_unused","required_inputs","input","inputConfig","type","message","extractRequiredInputs","inputs","variableRegex","standardNames","step_type","Array","isArray","variable","source","required","add","name","varName","cfg","optional","_unused2","match","template","exec","trim","some","s","toLowerCase","includes","replace","from","requiredInputs","updateStep","index","updates","newSteps","_objectSpread","addStep","newStep","length","concat","removeStep","filter","_","i","moveStep","direction","newIndex","toggleStepExpanded","newExpanded","has","delete","validateAndPrepareInputs","missingInputs","u","map","_inputConfigs$i","label","formatLabel","join","processedInputs","base64","content","String","emptyPromptSteps","handleStartExecution","runInBackground","arguments","undefined","result","startExecution","executionId","title","autoClose","duration","handleShowRunOptions","className","children","onClick","text","is_template","description","variant","placeholder","onChange","size","_models$find","find","m","e","stopPropagation","disabled","ChevronUpIcon","ChevronDownIcon","TrashIcon","ChevronIcon","target","api_config","apiConfig","service","endpoint","_unused3","options","available","rows","min","max","parseFloat","isOpen","onClose","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","c","toUpperCase","_ref3","_ref4","_ref5","_ref6"],"sources":["/Users/eveyhuang/Documents/novohaven-app/client/src/components/RecipeBuilder/RecipeRunner.tsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Recipe, RecipeStep, AIModel, InputTypeConfig, TemplateInputConfig } from '../../types';\nimport api from '../../services/api';\nimport { Button, Input, TextArea, Select, Card, CardBody, CardHeader, Modal, DynamicInput, TranslatedText } from '../common';\nimport { useLanguage } from '../../context/LanguageContext';\nimport { useNotifications } from '../../context/NotificationContext';\n\nconst DEFAULT_STEP: Omit<RecipeStep, 'id' | 'recipe_id' | 'created_at'> = {\n  step_order: 1,\n  step_name: 'New Step',\n  ai_model: 'mock',\n  prompt_template: '',\n  output_format: 'text',\n  model_config: JSON.stringify({ temperature: 0.7, maxTokens: 2000 }),\n};\n\nexport function RecipeRunner() {\n  const { id } = useParams();\n  const navigate = useNavigate();\n  const { t } = useLanguage();\n  const { trackExecution, addNotification } = useNotifications();\n\n  const [recipe, setRecipe] = useState<Recipe | null>(null);\n  const [localSteps, setLocalSteps] = useState<RecipeStep[]>([]);\n  const [inputValues, setInputValues] = useState<Record<string, any>>({});\n  const [inputConfigs, setInputConfigs] = useState<Record<string, InputTypeConfig>>({});\n  const [models, setModels] = useState<AIModel[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isStarting, setIsStarting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [expandedSteps, setExpandedSteps] = useState<Set<number>>(new Set([0]));\n  const [showVariableHelp, setShowVariableHelp] = useState(false);\n  const [showRunOptions, setShowRunOptions] = useState(false);\n\n  useEffect(() => {\n    loadModels();\n    if (id) {\n      loadRecipe(parseInt(id));\n    }\n  }, [id]);\n\n  const loadModels = async () => {\n    try {\n      const { all } = await api.getAIModels();\n      setModels(all);\n    } catch (err: any) {\n      console.error('Failed to load models:', err);\n    }\n  };\n\n  const loadRecipe = async (recipeId: number) => {\n    setIsLoading(true);\n    try {\n      const data = await api.getRecipe(recipeId);\n      setRecipe(data);\n      setLocalSteps(data.steps || []);\n\n      // Initialize input values and configs from step input_config\n      const initialValues: Record<string, any> = {};\n      const configs: Record<string, InputTypeConfig> = {};\n\n      // Collect input configs and default values from all steps\n      (data.steps || []).forEach((step) => {\n        if (step.input_config) {\n          try {\n            const config: TemplateInputConfig = JSON.parse(step.input_config);\n            // Collect variable configurations\n            if (config.variables) {\n              Object.entries(config.variables).forEach(([key, varConfig]) => {\n                configs[key] = varConfig;\n              });\n            }\n            // Collect default values (if any)\n            if ((config as any).defaultValues) {\n              Object.entries((config as any).defaultValues).forEach(([key, value]) => {\n                if (value) {\n                  initialValues[key] = value;\n                }\n              });\n            }\n          } catch {\n            // Ignore parse errors\n          }\n        }\n      });\n\n      // Then ensure all required inputs have appropriate default values\n      (data.required_inputs || []).forEach((input) => {\n        if (!(input in initialValues)) {\n          const inputConfig = configs[input];\n          // Set appropriate default based on type\n          if (inputConfig?.type === 'url_list') {\n            initialValues[input] = [''];\n          } else if (inputConfig?.type === 'image' || inputConfig?.type === 'file') {\n            initialValues[input] = null;\n          } else {\n            initialValues[input] = '';\n          }\n        }\n      });\n\n      setInputValues(initialValues);\n      setInputConfigs(configs);\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Extract required inputs from current step prompts and input configs\n  const extractRequiredInputs = (): string[] => {\n    const inputs = new Set<string>();\n    const variableRegex = /\\{\\{([^}]+)\\}\\}/g;\n\n    const standardNames = [\n      'brand_voice', 'amazon_requirements', 'social_media_guidelines',\n      'image_style_guidelines', 'platform_requirements', 'tone_guidelines',\n    ];\n\n    for (const step of localSteps) {\n      // For scraping steps, get inputs from input_config\n      if (step.step_type === 'scraping' && step.input_config) {\n        try {\n          const config = JSON.parse(step.input_config);\n          if (config.variables) {\n            // Handle both array format and object format\n            if (Array.isArray(config.variables)) {\n              // Array format: [{ name: 'product_urls', source: 'user_input', ... }]\n              for (const variable of config.variables) {\n                if (variable.source === 'user_input' && variable.required !== false) {\n                  inputs.add(variable.name);\n                }\n              }\n            } else {\n              // Object format: { product_urls: { type: 'url_list', ... } }\n              for (const [varName, varConfig] of Object.entries(config.variables)) {\n                const cfg = varConfig as any;\n                // Skip optional variables\n                if (cfg.optional !== true) {\n                  inputs.add(varName);\n                }\n              }\n            }\n          }\n        } catch {\n          // Ignore parse errors\n        }\n        continue;\n      }\n\n      // For AI steps, get inputs from prompt_template\n      let match;\n      const template = step.prompt_template || '';\n      while ((match = variableRegex.exec(template)) !== null) {\n        const varName = match[1].trim();\n        // Skip step outputs and company standards\n        if (!varName.match(/^step_\\d+_output$/) &&\n            !standardNames.some(s => varName.toLowerCase().includes(s.replace(/_/g, '')))) {\n          inputs.add(varName);\n        }\n      }\n    }\n    return Array.from(inputs);\n  };\n\n  const requiredInputs = extractRequiredInputs();\n\n  const updateStep = (index: number, updates: Partial<RecipeStep>) => {\n    const newSteps = [...localSteps];\n    newSteps[index] = { ...newSteps[index], ...updates };\n    setLocalSteps(newSteps);\n  };\n\n  const addStep = () => {\n    const newStep: RecipeStep = {\n      ...DEFAULT_STEP,\n      step_order: localSteps.length + 1,\n      step_name: `Step ${localSteps.length + 1}`,\n    } as RecipeStep;\n    setLocalSteps([...localSteps, newStep]);\n    setExpandedSteps(new Set([...expandedSteps, localSteps.length]));\n  };\n\n  const removeStep = (index: number) => {\n    if (localSteps.length <= 1) {\n      setError('Recipe must have at least one step');\n      return;\n    }\n    const newSteps = localSteps.filter((_, i) => i !== index);\n    // Renumber steps\n    newSteps.forEach((step, i) => {\n      step.step_order = i + 1;\n    });\n    setLocalSteps(newSteps);\n  };\n\n  const moveStep = (index: number, direction: 'up' | 'down') => {\n    const newIndex = direction === 'up' ? index - 1 : index + 1;\n    if (newIndex < 0 || newIndex >= localSteps.length) return;\n\n    const newSteps = [...localSteps];\n    [newSteps[index], newSteps[newIndex]] = [newSteps[newIndex], newSteps[index]];\n    // Renumber steps\n    newSteps.forEach((step, i) => {\n      step.step_order = i + 1;\n    });\n    setLocalSteps(newSteps);\n  };\n\n  const toggleStepExpanded = (index: number) => {\n    const newExpanded = new Set(expandedSteps);\n    if (newExpanded.has(index)) {\n      newExpanded.delete(index);\n    } else {\n      newExpanded.add(index);\n    }\n    setExpandedSteps(newExpanded);\n  };\n\n  const validateAndPrepareInputs = (): Record<string, string> | null => {\n    // Check for missing required inputs based on their type\n    const missingInputs = requiredInputs.filter((input) => {\n      const value = inputValues[input];\n      const config = inputConfigs[input];\n\n      if (!config || config.type === 'text' || config.type === 'textarea') {\n        return !value || (typeof value === 'string' && !value.trim());\n      } else if (config.type === 'image' || config.type === 'file') {\n        return !value;\n      } else if (config.type === 'url_list') {\n        return !Array.isArray(value) || value.filter((u: string) => u.trim()).length === 0;\n      }\n      return !value;\n    });\n\n    if (missingInputs.length > 0) {\n      setError(`${t('fillRequiredFields')}: ${missingInputs.map(i => inputConfigs[i]?.label || formatLabel(i)).join(', ')}`);\n      return null;\n    }\n\n    // Prepare input data - convert complex types to strings for prompt injection\n    const processedInputs: Record<string, string> = {};\n    for (const [key, value] of Object.entries(inputValues)) {\n      const config = inputConfigs[key];\n\n      if (config?.type === 'image' && value?.base64) {\n        // For images, include the base64 data (will be used by vision models)\n        processedInputs[key] = value.base64;\n        processedInputs[`${key}_description`] = `[Image: ${value.name}]`;\n      } else if (config?.type === 'file' && value?.content) {\n        // For files, include the content\n        processedInputs[key] = value.content;\n      } else if (config?.type === 'url_list' && Array.isArray(value)) {\n        // For URL lists, join them\n        processedInputs[key] = value.filter((u: string) => u.trim()).join('\\n');\n      } else if (typeof value === 'string') {\n        processedInputs[key] = value;\n      } else {\n        processedInputs[key] = String(value || '');\n      }\n    }\n\n    // Check that all AI steps have prompts (scraping steps don't need prompts)\n    const emptyPromptSteps = localSteps.filter(s =>\n      s.step_type !== 'scraping' && (!s.prompt_template || !s.prompt_template.trim())\n    );\n    if (emptyPromptSteps.length > 0) {\n      setError('All AI steps must have a prompt template');\n      return null;\n    }\n\n    return processedInputs;\n  };\n\n  const handleStartExecution = async (runInBackground: boolean = false) => {\n    if (!recipe) return;\n\n    const processedInputs = validateAndPrepareInputs();\n    if (!processedInputs) return;\n\n    setIsStarting(true);\n    setError(null);\n    setShowRunOptions(false);\n\n    try {\n      // Pass modified steps to the execution with processed inputs\n      const result = await api.startExecution(recipe.id, processedInputs, localSteps);\n\n      if (runInBackground) {\n        // Track the execution in background and navigate to dashboard\n        trackExecution(result.executionId, recipe.name);\n        addNotification({\n          type: 'info',\n          title: 'Workflow Started',\n          message: `\"${recipe.name}\" is now running in the background.`,\n          autoClose: true,\n          duration: 3000,\n        });\n        navigate('/');\n      } else {\n        // Navigate directly to the execution view\n        navigate(`/executions/${result.executionId}`);\n      }\n    } catch (err: any) {\n      setError(err.message);\n      setIsStarting(false);\n    }\n  };\n\n  const handleShowRunOptions = () => {\n    const processedInputs = validateAndPrepareInputs();\n    if (processedInputs) {\n      setShowRunOptions(true);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"></div>\n      </div>\n    );\n  }\n\n  if (!recipe) {\n    return (\n      <div className=\"text-center py-12\">\n        <p className=\"text-secondary-600\">{t('recipeNotFound')}</p>\n        <Button onClick={() => navigate('/')} className=\"mt-4\">\n          {t('goToDashboard')}\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <div className=\"flex items-center space-x-2\">\n            <h1 className=\"text-2xl font-bold text-secondary-900\">\n              <TranslatedText text={recipe.name} />\n            </h1>\n            {recipe.is_template && (\n              <span className=\"px-2 py-0.5 text-xs font-medium bg-primary-100 text-primary-700 rounded\">\n                {t('template')}\n              </span>\n            )}\n          </div>\n          {recipe.description && (\n            <p className=\"text-secondary-600 mt-1\">\n              <TranslatedText text={recipe.description} />\n            </p>\n          )}\n        </div>\n        <div className=\"flex items-center space-x-3\">\n          <Button variant=\"ghost\" onClick={() => navigate('/')}>\n            {t('cancel')}\n          </Button>\n          <Button onClick={handleShowRunOptions} isLoading={isStarting}>\n            {t('startWorkflow')}\n          </Button>\n        </div>\n      </div>\n\n      {error && (\n        <div className=\"bg-red-50 text-red-700 px-4 py-3 rounded-lg\">\n          {error}\n        </div>\n      )}\n\n      {/* Input Values */}\n      {requiredInputs.length > 0 && (\n        <Card>\n          <CardHeader>\n            <h2 className=\"font-semibold text-secondary-900\">{t('inputValues')}</h2>\n            <p className=\"text-sm text-secondary-500 mt-1\">\n              {t('provideInputs')}\n            </p>\n          </CardHeader>\n          <CardBody className=\"space-y-4\">\n            {requiredInputs.map((input) => {\n              const config = inputConfigs[input] || {\n                type: 'text' as const,\n                label: formatLabel(input),\n                placeholder: `Enter ${formatLabel(input).toLowerCase()}...`,\n              };\n\n              // Ensure label defaults to formatted input name\n              if (!config.label) {\n                config.label = formatLabel(input);\n              }\n\n              return (\n                <DynamicInput\n                  key={input}\n                  name={input}\n                  config={config}\n                  value={inputValues[input]}\n                  onChange={(value) =>\n                    setInputValues({ ...inputValues, [input]: value })\n                  }\n                  t={t}\n                />\n              );\n            })}\n          </CardBody>\n        </Card>\n      )}\n\n      {/* Workflow Steps */}\n      <div>\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-lg font-semibold text-secondary-900\">{t('workflowSteps')}</h2>\n            <p className=\"text-sm text-secondary-500\">\n              {t('customizePrompts')}\n            </p>\n          </div>\n          <div className=\"flex items-center space-x-2\">\n            <button\n              onClick={() => setShowVariableHelp(true)}\n              className=\"text-sm text-primary-600 hover:text-primary-700\"\n            >\n              {t('variableHelp')}\n            </button>\n            <Button size=\"sm\" onClick={addStep}>\n              {t('addStep')}\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          {localSteps.map((step, index) => (\n            <Card key={index}>\n              <div\n                className=\"px-6 py-4 flex items-center justify-between cursor-pointer hover:bg-secondary-50\"\n                onClick={() => toggleStepExpanded(index)}\n              >\n                <div className=\"flex items-center space-x-4\">\n                  <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center font-semibold ${\n                    step.step_type === 'scraping'\n                      ? 'bg-blue-100 text-blue-700'\n                      : 'bg-primary-100 text-primary-700'\n                  }`}>\n                    {step.step_type === 'scraping' ? 'üîç' : index + 1}\n                  </div>\n                  <div>\n                    <h4 className=\"font-medium text-secondary-900\">\n                      <TranslatedText text={step.step_name} />\n                    </h4>\n                    <p className=\"text-sm text-secondary-500\">\n                      {step.step_type === 'scraping'\n                        ? 'BrightData Scraping'\n                        : models.find(m => m.id === step.ai_model)?.name || step.ai_model}\n                    </p>\n                  </div>\n                </div>\n                <div className=\"flex items-center space-x-2\">\n                  <button\n                    onClick={(e) => { e.stopPropagation(); moveStep(index, 'up'); }}\n                    disabled={index === 0}\n                    className=\"p-1 text-secondary-400 hover:text-secondary-600 disabled:opacity-30\"\n                  >\n                    <ChevronUpIcon className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); moveStep(index, 'down'); }}\n                    disabled={index === localSteps.length - 1}\n                    className=\"p-1 text-secondary-400 hover:text-secondary-600 disabled:opacity-30\"\n                  >\n                    <ChevronDownIcon className=\"w-4 h-4\" />\n                  </button>\n                  <button\n                    onClick={(e) => { e.stopPropagation(); removeStep(index); }}\n                    className=\"p-1 text-red-400 hover:text-red-600\"\n                  >\n                    <TrashIcon className=\"w-4 h-4\" />\n                  </button>\n                  <ChevronIcon\n                    className={`w-5 h-5 text-secondary-400 transition-transform ${\n                      expandedSteps.has(index) ? 'transform rotate-180' : ''\n                    }`}\n                  />\n                </div>\n              </div>\n\n              {expandedSteps.has(index) && (\n                <CardBody className=\"border-t border-secondary-100 space-y-4\">\n                  <Input\n                    label={t('stepName')}\n                    value={step.step_name}\n                    onChange={(e) => updateStep(index, { step_name: e.target.value })}\n                    placeholder={t('stepNamePlaceholder')}\n                  />\n\n                  {/* Scraping Step UI */}\n                  {step.step_type === 'scraping' ? (\n                    <div className=\"space-y-4\">\n                      <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                        <div className=\"flex items-center space-x-2 mb-2\">\n                          <span className=\"text-2xl\">üîç</span>\n                          <h4 className=\"font-medium text-blue-800\">Scraping Step</h4>\n                        </div>\n                        <p className=\"text-sm text-blue-700\">\n                          This step extracts product reviews from e-commerce URLs using the BrightData API.\n                          You can also upload CSV files with review data.\n                        </p>\n                        {step.api_config && (() => {\n                          try {\n                            const apiConfig = JSON.parse(step.api_config);\n                            return (\n                              <div className=\"mt-3 text-sm\">\n                                <span className=\"text-blue-600 font-medium\">Service:</span>\n                                <span className=\"ml-2 text-blue-800\">{apiConfig.service}</span>\n                                <span className=\"ml-4 text-blue-600 font-medium\">Endpoint:</span>\n                                <span className=\"ml-2 text-blue-800\">{apiConfig.endpoint}</span>\n                              </div>\n                            );\n                          } catch {\n                            return null;\n                          }\n                        })()}\n                      </div>\n                      <div className=\"bg-secondary-50 rounded-lg p-4\">\n                        <h5 className=\"text-sm font-medium text-secondary-700 mb-2\">Supported Platforms</h5>\n                        <div className=\"flex space-x-2\">\n                          <span className=\"px-2 py-1 bg-orange-100 text-orange-800 text-xs rounded border border-orange-200\">\n                            üì¶ Amazon\n                          </span>\n                          <span className=\"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded border border-blue-200\">\n                            üõí Walmart\n                          </span>\n                          <span className=\"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded border border-purple-200\">\n                            üè† Wayfair\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  ) : (\n                    /* AI Step UI */\n                    <>\n                      <Select\n                        label={t('aiModel')}\n                        value={step.ai_model}\n                        onChange={(e) => updateStep(index, { ai_model: e.target.value })}\n                        options={models.map(m => ({\n                          value: m.id,\n                          label: `${m.name}${m.available ? '' : ` (${t('notConfigured')})`}`,\n                        }))}\n                      />\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-secondary-700 mb-1\">\n                          {t('promptTemplate')}\n                        </label>\n                        <TextArea\n                          value={step.prompt_template}\n                          onChange={(e) => updateStep(index, { prompt_template: e.target.value })}\n                          placeholder={t('promptTemplatePlaceholder')}\n                          rows={8}\n                          className=\"font-mono text-sm\"\n                        />\n                        <p className=\"mt-1 text-sm text-secondary-500\">\n                          {t('promptTemplateHelp')}\n                        </p>\n                      </div>\n\n                      <Select\n                        label={t('outputFormat')}\n                        value={step.output_format}\n                        onChange={(e) => updateStep(index, { output_format: e.target.value as any })}\n                        options={[\n                          { value: 'text', label: t('plainText') },\n                          { value: 'markdown', label: t('markdown') },\n                          { value: 'json', label: t('json') },\n                        ]}\n                      />\n\n                      {/* Model Config */}\n                      <div className=\"border-t border-secondary-200 pt-4\">\n                        <h3 className=\"text-sm font-medium text-secondary-700 mb-3\">{t('modelSettings')}</h3>\n                        <div className=\"grid grid-cols-2 gap-4\">\n                          <Input\n                            label={t('temperature')}\n                            type=\"number\"\n                            min=\"0\"\n                            max=\"2\"\n                            step=\"0.1\"\n                            value={JSON.parse(step.model_config || '{}').temperature || 0.7}\n                            onChange={(e) => {\n                              const config = JSON.parse(step.model_config || '{}');\n                              config.temperature = parseFloat(e.target.value);\n                              updateStep(index, { model_config: JSON.stringify(config) });\n                            }}\n                          />\n                          <Input\n                            label={t('maxTokens')}\n                            type=\"number\"\n                            min=\"100\"\n                            max=\"100000\"\n                            step=\"100\"\n                            value={JSON.parse(step.model_config || '{}').maxTokens || 2000}\n                            onChange={(e) => {\n                              const config = JSON.parse(step.model_config || '{}');\n                              config.maxTokens = parseInt(e.target.value);\n                              updateStep(index, { model_config: JSON.stringify(config) });\n                            }}\n                          />\n                        </div>\n                      </div>\n                    </>\n                  )}\n                </CardBody>\n              )}\n            </Card>\n          ))}\n        </div>\n      </div>\n\n      {/* Bottom Actions */}\n      <div className=\"flex items-center justify-between pt-4 border-t border-secondary-200\">\n        <Button variant=\"ghost\" onClick={() => navigate('/')}>\n          {t('cancel')}\n        </Button>\n        <Button onClick={handleShowRunOptions} isLoading={isStarting} size=\"lg\">\n          {t('startWorkflow')}\n        </Button>\n      </div>\n\n      {/* Variable Help Modal */}\n      <Modal\n        isOpen={showVariableHelp}\n        onClose={() => setShowVariableHelp(false)}\n        title={t('variableReference')}\n        size=\"lg\"\n      >\n        <div className=\"space-y-4\">\n          <div>\n            <h3 className=\"font-semibold text-secondary-900\">{t('userInputVariables')}</h3>\n            <p className=\"text-sm text-secondary-600 mt-1\">\n              <code className=\"bg-secondary-100 px-1 rounded\">{'{{variable_name}}'}</code> {t('userInputVariablesDesc')}\n            </p>\n            <div className=\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\">\n              {'{{product_name}}'}<br/>\n              {'{{target_audience}}'}<br/>\n              {'{{additional_context}}'}\n            </div>\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-secondary-900\">{t('previousStepOutputs')}</h3>\n            <p className=\"text-sm text-secondary-600 mt-1\">\n              {t('previousStepOutputsDesc')} <code className=\"bg-secondary-100 px-1 rounded\">{'{{step_N_output}}'}</code>\n            </p>\n            <div className=\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\">\n              {'{{step_1_output}}'}<br/>\n              {'{{step_2_output}}'}\n            </div>\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-secondary-900\">{t('companyStandards')}</h3>\n            <p className=\"text-sm text-secondary-600 mt-1\">\n              {t('companyStandardsDesc')}\n            </p>\n            <div className=\"mt-2 bg-secondary-50 p-3 rounded text-sm font-mono\">\n              {'{{brand_voice}}'}<br/>\n              {'{{amazon_requirements}}'}<br/>\n              {'{{image_style_guidelines}}'}\n            </div>\n          </div>\n        </div>\n      </Modal>\n\n      {/* Run Options Modal */}\n      <Modal\n        isOpen={showRunOptions}\n        onClose={() => setShowRunOptions(false)}\n        title=\"Start Workflow\"\n        size=\"md\"\n      >\n        <div className=\"space-y-4\">\n          <p className=\"text-secondary-600\">\n            Choose how you want to run this workflow:\n          </p>\n\n          <div className=\"space-y-3\">\n            {/* Run and Watch Option */}\n            <button\n              onClick={() => handleStartExecution(false)}\n              disabled={isStarting}\n              className=\"w-full p-4 border-2 border-secondary-200 rounded-lg hover:border-primary-500 hover:bg-primary-50 transition-colors text-left group\"\n            >\n              <div className=\"flex items-start space-x-3\">\n                <div className=\"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center flex-shrink-0 group-hover:bg-primary-200\">\n                  <svg className=\"w-5 h-5 text-primary-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z\" />\n                  </svg>\n                </div>\n                <div className=\"flex-1\">\n                  <h4 className=\"font-medium text-secondary-900\">Run and Watch</h4>\n                  <p className=\"text-sm text-secondary-500 mt-1\">\n                    Stay on the execution page to monitor progress and approve steps in real-time.\n                  </p>\n                </div>\n              </div>\n            </button>\n\n            {/* Run in Background Option */}\n            <button\n              onClick={() => handleStartExecution(true)}\n              disabled={isStarting}\n              className=\"w-full p-4 border-2 border-secondary-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left group\"\n            >\n              <div className=\"flex items-start space-x-3\">\n                <div className=\"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0 group-hover:bg-blue-200\">\n                  <svg className=\"w-5 h-5 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z\" />\n                  </svg>\n                </div>\n                <div className=\"flex-1\">\n                  <h4 className=\"font-medium text-secondary-900\">Run in Background</h4>\n                  <p className=\"text-sm text-secondary-500 mt-1\">\n                    Start the workflow and continue working. You'll be notified when it needs attention or completes.\n                  </p>\n                </div>\n              </div>\n            </button>\n          </div>\n\n          <div className=\"pt-3 border-t border-secondary-200\">\n            <Button variant=\"ghost\" onClick={() => setShowRunOptions(false)} className=\"w-full\">\n              Cancel\n            </Button>\n          </div>\n        </div>\n      </Modal>\n    </div>\n  );\n}\n\nfunction formatLabel(varName: string): string {\n  return varName\n    .replace(/_/g, ' ')\n    .replace(/\\b\\w/g, (c) => c.toUpperCase());\n}\n\n// Icons\nfunction ChevronUpIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n    </svg>\n  );\n}\n\nfunction ChevronDownIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n    </svg>\n  );\n}\n\nfunction ChevronIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 9l-7 7-7-7\" />\n    </svg>\n  );\n}\n\nfunction TrashIcon({ className }: { className?: string }) {\n  return (\n    <svg className={className} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n    </svg>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}